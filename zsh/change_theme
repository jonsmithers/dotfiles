#!/bin/bash

function change_vim_colorscheme() {
  local theme=$1
  echo setting vim theme to $theme
  local line_to_insert="export VIM_COLORSCHEME=$theme"
  # comment out previous colorscheme
  if cat ~/.zprofile | grep --quiet '^export VIM_COLORSCHEME'; then
    sed -I '.sedbackup' 's/^export VIM_COLORSCHEME=.*/'"$line_to_insert"'/' ~/.zprofile
    rm ~/.zprofile.sedbackup
  else
    echo "$line_to_insert" >> ~/.zprofile
  fi
}
function change_vim_background() {
  local background=$1
  local line_to_insert="export VIM_BACKGROUND=$background"
  if cat ~/.zprofile | grep --quiet '^export VIM_BACKGROUND'; then
    sed -I '.sedbackup' 's/^export VIM_BACKGROUND=.*/'"$line_to_insert"'/' ~/.zprofile
    rm ~/.zprofile.sedbackup
  else
    echo "$line_to_insert" >> ~/.zprofile
  fi
}
function change_kitty_theme() {
  local theme=$1
  echo setting kitty theme to $theme
  echo "include $theme.conf" >> ~/.config/kitty/kitty.conf
  [[ ! -f "$HOME/.config/kitty/$theme.conf" ]] && {
    echo obtaining theme from kitten
    kitty +kitten themes --dump-theme "$theme" > "$HOME/.config/kitty/$theme.conf" || (
      echo obtaining theme from github/projekt0n/github-nvim-theme;
      curl https://raw.githubusercontent.com/projekt0n/github-nvim-theme/main/terminal/kitty/"$theme".conf > ~/.config/kitty/"$theme".conf;
    )
  }
}

theme=$1
if [[ -z "$theme" ]]; then
  themes=(
    "Apprentice Dark"
    "Ayu Dark"
    "GitHub Dark"
    "GitHub Dark Colorblind"
    "GitHub Dark Default"
    "GitHub Dimmed"
    "GitHub Light"
    "GitHub Light Default"
    "Gruvbox Dark"
    "Gruvbox Light"
    "One Dark"
    "One Light"
  );
  PS3="select theme> "
  select theme in "${themes[@]}"; do
    break
  done
fi

case $theme in
  "Ayu Dark")
    change_vim_colorscheme ayu
    change_vim_background dark
    change_kitty_theme Ayu
    ;;
  "Apprentice Dark")
    change_vim_colorscheme apprentice
    change_vim_background dark
    change_kitty_theme 'Apprentice'
    ;;
  "GitHub Dark")
    change_vim_background dark
    change_vim_colorscheme github_dark
    change_kitty_theme github_dark
    # curl https://raw.githubusercontent.com/projekt0n/github-nvim-theme/main/terminal/kitty/github_dark.conf > ~/.config/kitty/github_dark.conf
    ;;
  "GitHub Dark Default")
    change_vim_background dark
    change_vim_colorscheme github_dark_default
    change_kitty_theme github_dark_default
    # curl https://raw.githubusercontent.com/projekt0n/github-nvim-theme/main/terminal/kitty/github_dark_default.conf > ~/.config/kitty/github_dark_default.conf
    ;;
  "GitHub Dark Colorblind")
    change_vim_background dark
    change_vim_colorscheme github_dark_colorblind
    change_kitty_theme github_dark_colorblind
    # curl https://raw.githubusercontent.com/projekt0n/github-nvim-theme/main/terminal/kitty/github_dark_colorblind.conf > ~/.config/kitty/github_dark_colorblind.conf
    ;;
  "GitHub Dimmed")
    change_vim_background dark
    change_vim_colorscheme github_dimmed
    change_kitty_theme github_dimmed
    # curl https://raw.githubusercontent.com/projekt0n/github-nvim-theme/main/terminal/kitty/github_dimmed.conf > ~/.config/kitty/github_dimmed.conf
    ;;
  "GitHub Light")
    change_vim_background dark
    change_vim_colorscheme github_light
    change_kitty_theme github_light
    # curl https://raw.githubusercontent.com/projekt0n/github-nvim-theme/main/terminal/kitty/github_light.conf > ~/.config/kitty/github_light.conf
    ;;
  "GitHub Light Default")
    change_vim_background dark
    change_vim_colorscheme github_light_default
    change_kitty_theme github_light_default
    # curl https://raw.githubusercontent.com/projekt0n/github-nvim-theme/main/terminal/kitty/github_light_default.conf > ~/.config/kitty/github_light_default.conf
    ;;
  "Gruvbox Dark")
    change_vim_colorscheme gruvbox
    change_vim_background dark
    change_kitty_theme 'Gruvbox Dark Hard'
    ;;
  "Gruvbox Light")
    change_vim_colorscheme gruvbox
    change_vim_background light
    change_kitty_theme 'Gruvbox Light Hard'
    ;;
  "One Dark")
    change_vim_colorscheme onedark
    change_vim_background dark
    change_kitty_theme 'One Dark'
    ;;
  "One Light")
    change_vim_colorscheme one
    change_vim_background light
    change_kitty_theme 'One Half Light'
    ;;
  *)
    echo \"$theme\" is not a recognized theme
    ;;
esac
